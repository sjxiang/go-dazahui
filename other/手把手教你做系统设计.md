

# 手把手教你做系统设计之秒杀系统



概述，本节课程主要分为四个方面：

1. 系统设计方法论
2. 电商秒杀业务介绍
3. 课程实践
4. 课程总结



# 1 - 系统设计方法论

如何做系统设计（ 4S 分析法）

    - 场景分析
        什么系统、需要哪些功能、多大的并发量

    - 存储设计
        数据如何组织、SQL 存储、NoSQL 存储

    - 服务设计
        业务功能实现和逻辑整合

    - 可扩展性
        解决设计缺陷，提高鲁棒性、扩展性


如何分析系统瓶颈和优化

    - 火焰图分析
    - 链路分析
    - 全链路压测



如何验证系统的可用性和稳定性

    - 链路梳理

        - 核心链路
            电商：商品详情 计算价格 提单 下单 支付
    
        - 流量漏斗
        - 强弱依赖
            弱，降级；强，保障


    - 可观测性
        
        - 
        - 
        - 
        

    - 全链路测试

    - 稳定性控制

    - 容灾演练





# 领域知识

    电商和秒杀



类目 > SPU > SKU

某款衣服三个尺码，前者在于定性（标准），后者在于定量（库存管理）



秒杀业务的特点

    瞬时流量高
    读多写少
    实时性要求高


秒杀的挑战

    资源有限性
    反欺诈
    高性能
    防止超卖
    流量管控
    扩展性
    鲁棒性



设计秒杀系统（ 4S ）

场景 >> 存储 >> 服务 >> 扩展


功能：
    发布活动
    商品详情
    下单

并发：
    万人参与秒杀
    QPS 1w+
    TPS 1k+


子服务
    用户
    风控
    活动
    订单

基础组件
    ID 生成器
    缓存组件
    MQ 组件
    限流组件



流量隔离
CDN
缓存优化
流量管控

数据库扩展
    读写分离、分库分表

服务水平扩展
    负载均衡、反向代理

MQ 扩展
    主从架构

Redis 扩展
    集群

服务垂直扩展
    微服务拆分





实践
    秒杀流程


             用户抢购                  User 服务 (登录校验)
                | 下单                风控服务 （风控校验）
             秒杀系统  —————————————+  Redis （活动校验）（预扣库存）
                | 削峰                    
                MQ                     ^
                | 消费 MQ               |  刷新缓存
订单超时检查 -> 订单服务 -> 扣减库存 MySQL
                | 支付         （取消 & 下单失败库存回补）
             支付系统
 



总结
    高性能系统的通用设计思想

    服务无状态（横向扩展，当前服务不存取状态、数据）
    批量写入 batch
    最终一致性 



===

促销活动
促销产品
订单


活动名称

开始时间
结束时间
参与促销的商品
    活动的 sku id
    活动的 spu id
    数量
    价格
